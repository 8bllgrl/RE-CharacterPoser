heavily inspired by EMV-Engine.